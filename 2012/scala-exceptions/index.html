<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Abstracting exception handlers in Scala | Iulian, not Lulian </title> <meta name="description" content=" Scala offers many ways to abstract and reuse code, but one area where this is not entirely obvious is _exception_ handling. "> <meta name="keywords" content="Scala, error handling, exceptions, dsl"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Iulian Dragos"> <meta property="article:section" content=""> <meta property="article:tag" content="Scala, error handling, exceptions, dsl"> <meta property="article:published_time" content="2012-12-10 17:39:18 +0100"> <meta property="og:url" content="http://dragos.github.io/2012/scala-exceptions/"> <meta property="og:title" content=" Abstracting exception handlers in Scala | Iulian, not Lulian "> <meta property="og:image" content="http://dragos.github.io"> <meta property="og:description" content=" Scala offers many ways to abstract and reuse code, but one area where this is not entirely obvious is _exception_ handling. "> <meta property="og:site_name" content="Iulian Dragos"> <meta property="og:locale" content="pt_CH"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@jaguarul"> <meta name="twitter:title" content=" Abstracting exception handlers in Scala | Iulian, not Lulian "> <meta name="twitter:description" content=" Scala offers many ways to abstract and reuse code, but one area where this is not entirely obvious is _exception_ handling. "> <meta name="twitter:image:src" content="http://dragos.github.io"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Abstracting exception handlers in Scala | Iulian, not Lulian "> <meta itemprop="description" content=" Scala offers many ways to abstract and reuse code, but one area where this is not entirely obvious is _exception_ handling. "> <meta itemprop="image" content="http://dragos.github.io"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://dragos.github.io/2012/scala-exceptions/"> <link rel="alternate" type="application/rss+xml" title="Iulian, not Lulian " href="http://dragos.github.io/feed.xml"> <script type="text/javascript"> var disqus_shortname = 'dragos'; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-73750486-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">Iulian, not Lulian <span>blog</span></a></h1> <ul class="navbar"> <li> <a href="https://github.com/dragos"> GitHub </a> </li> <li><a href="/talks">talks</a></li> <li><a href="/about">about</a></li> <li><a href="/feed.xml" target="_blank">feed</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">Abstracting exception handlers in Scala</h1> <p class="post-meta"><time datetime="2012-12-10T17:39:18+01:00" itemprop="datePublished">Dec 10, 2012</time></p> </header> <div class="post-content" itemprop="articleBody"> <p>Scala offers many ways to abstract and reuse code, but one area where this is not entirely obvious is <em>exception</em> handling. Sure, when it comes to <em>error handling</em>, there are good ways to write elegant code: use <code>Option</code> or <code>Either</code> and soon <code>Try</code>. But when it comes to <em>exceptions</em>, for instance when interfacing with Java code, one has to write tedious <code>try-catch</code> blocks. In this post I will briefly describe a few utility methods in the standard library that are undeservedly obscure. I got the idea of this blog post when answering <a href="http://stackoverflow.com/questions/12618072/testing-if-a-given-instance-is-a-subclass-of-a-given-class-in-scala/12621215#12621215">this stack overflow question</a> (though my answer is not the most voted, I still think it’s the better solution ;-)).</p> <h3 id="scalautilcontrolexception">scala.util.control.Exception</h3> <p>This little utility class and allows the programmer to abstract over common patterns of handling exceptions. Let’s start with some code that catches an exception and converts it to <code>Option</code>.</p> <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">scala.util.control._</span>

<span class="k">object</span> <span class="nc">exceptions</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">Exception._</span>
  
  <span class="n">catching</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">NoSuchElementException</span><span class="o">]).</span><span class="n">opt</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">().</span><span class="n">head</span>
  <span class="o">}</span>                                               <span class="c1">//&gt; res1: Option[Nothing] = None</span>
<span class="o">}</span></code></pre></figure> <p><code>catching</code> loosely follows the <a href="http://en.wikipedia.org/wiki/Builder_pattern">builder pattern</a> and constructs a <code>Catcher</code> object, with user-configurable logic for <em>what</em> to catch and <em>how</em> to handle the exceptions. In our example, we pass an exception type and configure the catcher to convert the result to an option. Obviously, if an exception is thrown the result is <code>None</code></p> <p>In exactly the same way we could convert it to <code>Either</code>:</p> <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">scala.util.control.Exception._</span>

<span class="k">object</span> <span class="nc">exceptions</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">xs</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>

  <span class="n">catching</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">NoSuchElementException</span><span class="o">]).</span><span class="n">opt</span> <span class="o">{</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">head</span>
  <span class="o">}</span>                                               <span class="c1">//&gt; res0: Option[Int] = Some(1)</span>

  <span class="n">catching</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">NoSuchElementException</span><span class="o">]).</span><span class="n">either</span> <span class="o">{</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">head</span>
  <span class="o">}</span>                                               <span class="c1">//&gt; res1: scala.util.Either[Throwable,Int] = Right(1)</span>
<span class="o">}</span></code></pre></figure> <h3 id="canned-logic">Canned logic</h3> <p><code>catching</code> takes any number of exceptions and it is the most flexible way to use this library, but a few patterns come up often enough to warrant their addition to the standard library:</p> <ul> <li><code>nonFatalCatch</code> is, unsurprisingly, a catcher that re-throws fatal errors. Given that the Scala compiler sometimes relies on exceptions for control flow (like non-local returns), it’s a <em>very bad idea</em> to catch any of those</li> <li><code>ignoring(e1, e2, ..)</code> evaluates a block and catches given exceptions (it returns <code>Unit</code>, so this can be used only for side-effecting code</li> <li><code>failing(e1, e2, ..)</code> evaluates a block and catches given exceptions, returning <code>None</code> if the block throws an exception, wrapping the resulting value in an <code>Option</code></li> <li><code>failAsValue(e1, e2, ..)(default)</code> catches any of the given exceptions and returns a given default value if the block throws. For instance,</li> </ul> <figure class="highlight"><pre><code class="language-scala" data-lang="scala">  <span class="n">failAsValue</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">Exception</span><span class="o">])(-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">xs</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
  <span class="o">}</span>                                               <span class="c1">//&gt; res3: Int = -1</span></code></pre></figure> <p>Catchers can be customised even more, and that’s what I used in the SO answer. <code>withApply</code> can be used to pass a function that handles the exceptional case. For instance:</p> <figure class="highlight"><pre><code class="language-scala" data-lang="scala">  <span class="k">def</span> <span class="n">logError</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">Throwable</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;Error: &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="o">)</span>
    <span class="o">-</span><span class="mi">1</span>
  <span class="o">}</span>
  
  <span class="n">catching</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">Exception</span><span class="o">]).</span><span class="n">withApply</span><span class="o">(</span><span class="n">logError</span> <span class="k">_</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">xs</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
  <span class="o">}</span>                                               <span class="c1">//&gt; Error: java.lang.IndexOutOfBoundsException: 2</span>
                                                  <span class="c1">//| res3: Int = -1</span></code></pre></figure> <p>This example shows how the exception handling logic can be abstracted in a function. We can take this one step further and reuse entire catchers (since they are plain Scala values, there’s not much to be done):</p> <figure class="highlight"><pre><code class="language-scala" data-lang="scala">  <span class="k">val</span> <span class="n">loggingExceptions</span> <span class="k">=</span> <span class="n">catching</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">Exception</span><span class="o">]).</span><span class="n">withApply</span><span class="o">(</span><span class="n">logError</span> <span class="k">_</span><span class="o">)</span>
  
  <span class="n">loggingExceptions</span> <span class="o">{</span>
    <span class="n">xs</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
  <span class="o">}</span>                                               <span class="c1">//&gt; Error: java.lang.IndexOutOfBoundsException: 2</span>
                                                  <span class="c1">//| res3: Int = -1</span></code></pre></figure> <p>I’ve found this utility class very useful when integrating <a href="http://www.scala-ide.org">Scala code</a> with an existing <a href="http://www.eclipse.org">Java codebase</a>, and a good example of DSL design.</p> <aside class="share"> <h4>Share this.</h4> <a href="http://twitter.com/share?text=Abstracting exception handlers in Scala&amp;url=http://dragos.github.io/2012/scala-exceptions/&amp;via=jaguarul" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> </aside> </div> </article> <aside id="comments" class="disqus"> <div class="container"> <h3><i class="icon icon-comments-o"></i> Comments</h3> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'dragos'; var disqus_identifier = '/2012/scala-exceptions'; var disqus_title = 'Abstracting exception handlers in Scala'; var disqus_url = 'http://dragos.github.io'; /*var disqus_developer = 1;*/ (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a> </noscript> </div> </aside> <footer class="site-footer"> <div class="container"> <small class="pull-left">&copy;2016 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small> <small class="pull-right">themed by <a href="http://nandomoreira.me/" target="_blank">nandomoreira.me</a></small> </div> </footer> </main> </body> </html>
